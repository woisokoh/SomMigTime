tmax_idp_stat4 <- eca_clean(eca_pois4[[4]],eca_wtsur4[[4]],eca_shuf4[[4]])
tmax_idp_stat13 <- eca_clean(eca_pois13[[4]],eca_wtsur13[[4]],eca_shuf13[[4]])
tmax_conf_idp_stat1 <- eca_clean(eca_pois1[[5]],eca_wtsur1[[5]],eca_shuf1[[5]])
tmax_conf_idp_stat4 <- eca_clean(eca_pois4[[5]],eca_wtsur4[[5]],eca_shuf4[[5]])
tmax_conf_idp_stat13 <- eca_clean(eca_pois13[[5]],eca_wtsur13[[5]],eca_shuf13[[5]])
### Save in shapefile
# Precursor coincidence rate
shp$conf_idp_pre_other1 <- eca_pois1[[1]]$`precursor coincidence rate`
shp$conf_idp_pre_other4 <- eca_pois4[[1]]$`precursor coincidence rate`
shp$conf_idp_pre_other13 <- eca_pois13[[1]]$`precursor coincidence rate`
shp$rain_idp_pre_other1 <- eca_pois1[[2]]$`precursor coincidence rate`
shp$rain_idp_pre_other4 <- eca_pois4[[2]]$`precursor coincidence rate`
shp$rain_idp_pre_other13 <- eca_pois13[[2]]$`precursor coincidence rate`
shp$rain_conf_idp_pre_other1 <- eca_pois1[[3]]$`precursor coincidence rate`
shp$rain_conf_idp_pre_other4 <- eca_pois4[[3]]$`precursor coincidence rate`
shp$rain_conf_idp_pre_other13 <- eca_pois13[[3]]$`precursor coincidence rate`
shp$tmax_idp_pre_other1 <- eca_pois1[[4]]$`precursor coincidence rate`
shp$tmax_idp_pre_other4 <- eca_pois4[[4]]$`precursor coincidence rate`
shp$tmax_idp_pre_other13 <- eca_pois13[[4]]$`precursor coincidence rate`
shp$tmax_conf_idp_pre_other1 <- eca_pois1[[5]]$`precursor coincidence rate`
shp$tmax_conf_idp_pre_other4 <- eca_pois4[[5]]$`precursor coincidence rate`
shp$tmax_conf_idp_pre_other13 <- eca_pois13[[5]]$`precursor coincidence rate`
# coincidence occurrence
shp$conf_idp_pre_n_other1 <- eca_pois1[[1]]$`precursor coincidence rate` * eca_pois1[[1]]$`N precursor`
shp$conf_idp_pre_n_other4 <- eca_pois4[[1]]$`precursor coincidence rate` * eca_pois4[[1]]$`N precursor`
shp$conf_idp_pre_n_other13 <- eca_pois13[[1]]$`precursor coincidence rate` * eca_pois13[[1]]$`N precursor`
shp$rain_idp_pre_n_other1 <- eca_pois1[[2]]$`precursor coincidence rate` * eca_pois1[[2]]$`N precursor`
shp$rain_idp_pre_n_other4 <- eca_pois4[[2]]$`precursor coincidence rate` * eca_pois4[[2]]$`N precursor`
shp$rain_idp_pre_n_other13 <- eca_pois13[[2]]$`precursor coincidence rate` * eca_pois13[[2]]$`N precursor`
shp$rain_conf_idp_pre_n_other1 <- eca_pois1[[3]]$`precursor coincidence rate` * eca_pois1[[3]]$`N precursor`
shp$rain_conf_idp_pre_n_other4 <- eca_pois4[[3]]$`precursor coincidence rate` * eca_pois4[[3]]$`N precursor`
shp$rain_conf_idp_pre_n_other13 <- eca_pois13[[3]]$`precursor coincidence rate` * eca_pois13[[3]]$`N precursor`
shp$tmax_idp_pre_n_other1 <- eca_pois1[[4]]$`precursor coincidence rate` * eca_pois1[[4]]$`N precursor`
shp$tmax_idp_pre_n_other4 <- eca_pois4[[4]]$`precursor coincidence rate` * eca_pois4[[4]]$`N precursor`
shp$tmax_idp_pre_n_other13 <- eca_pois13[[4]]$`precursor coincidence rate` * eca_pois13[[4]]$`N precursor`
shp$tmax_conf_idp_pre_n_other1 <- eca_pois1[[5]]$`precursor coincidence rate` * eca_pois1[[5]]$`N precursor`
shp$tmax_conf_idp_pre_n_other4 <- eca_pois4[[5]]$`precursor coincidence rate` * eca_pois4[[5]]$`N precursor`
shp$tmax_conf_idp_pre_n_other13 <- eca_pois13[[5]]$`precursor coincidence rate` * eca_pois13[[5]]$`N precursor`
# P-value
shp$conf_idp_pre_pv_pois1 <- eca_pois1[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_pois4 <- eca_pois4[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_pois13 <- eca_pois13[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_wtsur1 <- eca_wtsur1[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_wtsur4 <- eca_wtsur4[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_wtsur13 <- eca_wtsur13[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_shuf1 <- eca_shuf1[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_shuf4 <- eca_shuf4[[1]]$`p-value precursor`
shp$conf_idp_pre_pv_shuf13 <- eca_shuf13[[1]]$`p-value precursor`
shp$rain_idp_pre_pv_pois1 <- eca_pois1[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_pois4 <- eca_pois4[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_pois13 <- eca_pois13[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_wtsur1 <- eca_wtsur1[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_wtsur4 <- eca_wtsur4[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_wtsur13 <- eca_wtsur13[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_shuf1 <- eca_shuf1[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_shuf4 <- eca_shuf4[[2]]$`p-value precursor`
shp$rain_idp_pre_pv_shuf13 <- eca_shuf13[[2]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_pois1 <- eca_pois1[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_pois4 <- eca_pois4[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_pois13 <- eca_pois13[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_wtsur1 <- eca_wtsur1[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_wtsur4 <- eca_wtsur4[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_wtsur13 <- eca_wtsur13[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_shuf1 <- eca_shuf1[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_shuf4 <- eca_shuf4[[3]]$`p-value precursor`
shp$rain_conf_idp_pre_pv_shuf13 <- eca_shuf13[[3]]$`p-value precursor`
shp$tmax_idp_pre_pv_pois1 <- eca_pois1[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_pois4 <- eca_pois4[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_pois13 <- eca_pois13[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_wtsur1 <- eca_wtsur1[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_wtsur4 <- eca_wtsur4[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_wtsur13 <- eca_wtsur13[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_shuf1 <- eca_shuf1[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_shuf4 <- eca_shuf4[[4]]$`p-value precursor`
shp$tmax_idp_pre_pv_shuf13 <- eca_shuf13[[4]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_pois1 <- eca_pois1[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_pois4 <- eca_pois4[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_pois13 <- eca_pois13[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_wtsur1 <- eca_wtsur1[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_wtsur4 <- eca_wtsur4[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_wtsur13 <- eca_wtsur13[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_shuf1 <- eca_shuf1[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_shuf4 <- eca_shuf4[[5]]$`p-value precursor`
shp$tmax_conf_idp_pre_pv_shuf13 <- eca_shuf13[[5]]$`p-value precursor`
shp$conf_idp_pre_pv_other1 <- conf_idp_stat1*1
shp$conf_idp_pre_pv_other4 <- conf_idp_stat4*1
shp$conf_idp_pre_pv_other13 <- conf_idp_stat13*1
shp$conf_idp_pre_pv_other1[is.nan(shp$conf_idp_pre_pv_other1)] <- -1
shp$conf_idp_pre_pv_other4[is.nan(shp$conf_idp_pre_pv_other4)] <- -1
shp$conf_idp_pre_pv_other13[is.nan(shp$conf_idp_pre_pv_other13)] <- -1
shp$rain_idp_pre_pv_other1 <- rain_idp_stat1*1
shp$rain_idp_pre_pv_other4 <- rain_idp_stat4*1
shp$rain_idp_pre_pv_other13 <- rain_idp_stat13*1
shp$rain_idp_pre_pv_other1[is.nan(shp$rain_idp_pre_pv_other1)] <- -1
shp$rain_idp_pre_pv_other4[is.nan(shp$rain_idp_pre_pv_other4)] <- -1
shp$rain_idp_pre_pv_other13[is.nan(shp$rain_idp_pre_pv_other13)] <- -1
shp$rain_conf_idp_pre_pv_other1 <- rain_conf_idp_stat1*1
shp$rain_conf_idp_pre_pv_other4 <- rain_conf_idp_stat4*1
shp$rain_conf_idp_pre_pv_other13 <- rain_conf_idp_stat13*1
shp$rain_conf_idp_pre_pv_other1[is.nan(shp$rain_conf_idp_pre_pv_other1)] <- -1
shp$rain_conf_idp_pre_pv_other4[is.nan(shp$rain_conf_idp_pre_pv_other4)] <- -1
shp$rain_conf_idp_pre_pv_other13[is.nan(shp$rain_conf_idp_pre_pv_other13)] <- -1
shp$tmax_idp_pre_pv_other1 <- tmax_idp_stat1*1
shp$tmax_idp_pre_pv_other4 <- tmax_idp_stat4*1
shp$tmax_idp_pre_pv_other13 <- tmax_idp_stat13*1
shp$tmax_idp_pre_pv_other1[is.nan(shp$tmax_idp_pre_pv_other1)] <- -1
shp$tmax_idp_pre_pv_other4[is.nan(shp$tmax_idp_pre_pv_other4)] <- -1
shp$tmax_idp_pre_pv_other13[is.nan(shp$tmax_idp_pre_pv_other13)] <- -1
shp$tmax_conf_idp_pre_pv_other1 <- tmax_conf_idp_stat1*1
shp$tmax_conf_idp_pre_pv_other4 <- tmax_conf_idp_stat4*1
shp$tmax_conf_idp_pre_pv_other13 <- tmax_conf_idp_stat13*1
shp$tmax_conf_idp_pre_pv_other1[is.nan(shp$tmax_conf_idp_pre_pv_other1)] <- -1
shp$tmax_conf_idp_pre_pv_other4[is.nan(shp$tmax_conf_idp_pre_pv_other4)] <- -1
shp$tmax_conf_idp_pre_pv_other13[is.nan(shp$tmax_conf_idp_pre_pv_other13)] <- -1
# Plot ECA results
setwd(dir.out)
eca_plot(shp,1,"other")
library(grid) #
sessionInfo()
eca_plot(shp,1,"other")
library(grid)
# Plot ECA results
setwd(dir.out)
eca_plot(shp,1,"other")
library(gridExtra) #
sessionInfo()
library(gridExtra) #
library(gridExtra) #
sessionInfo()
eca_plot(shp,1,"other")
eca_plot(shp,4,"other")
eca_plot(shp,13,"other")
# Plot correlation between burstiness and coincidence rates
setwd(dir.out)
corr_plot(BMOther,eca_pois1,1,0.05,nan_ctr = FALSE,"other")
corr_plot(BMOther,eca_pois4,4,0.05,nan_ctr = FALSE,"other")
corr_plot(BMOther,eca_pois13,13,0.05,nan_ctr = FALSE,"other")
corr_plot(BMOther,eca_pois1,1,0.05,nan_ctr = TRUE,"other")
corr_plot(BMOther,eca_pois4,4,0.05,nan_ctr = TRUE,"other")
corr_plot(BMOther,eca_pois13,13,0.05,nan_ctr = TRUE,"other")
# Print aggregate values
agg_cal(shp,timeDistOther)
# Load user-defined functions
setwd(dir.udf)
dump("eca_udf", file="eca_udf");source("eca_udf.R")
dump("bursty_GB_udf", file="bursty_GB_udf");source("bursty_GB_udf.R")
dump("bursty_KJ_udf", file="bursty_KJ_udf");source("bursty_KJ_udf.R")
dump("BM_cal_udf", file="BM_cal_udf");source("BM_cal_udf.R")
# Plot ECA results
# Produce two plots (c: conflict, d: dry weather, h: hot weather, m: migration)
# 1. c-m coincidence rates, d-m coincidence rates, d-c-m coincidence rates (coinratemap_rain....png)
# 2. c-m coincidence rates, h-m coincidence rates, h-c-m coincidence rates (coinratemap_tmax....png)
setwd(dir.out)
eca_plot(shp,1,"other")
eca_plot(shp,4,"other")
eca_plot(shp,13,"other") # Figure 3
?quantile
timeDistOther25 <- ts_crt(outidp_dat,0.25,"mig")
timeDistOther50 <- ts_crt(outidp_dat,0.50,"mig")
timeDistOther75 <- ts_crt(outidp_dat,0.75,"mig")
BMOther25 <- BM_cal(timeDistOther25)
BMOther50 <- BM_cal(timeDistOther50)
BMOther75 <- BM_cal(timeDistOther75)
setwd(dir.out)
p_BM25 <- BM_plot(BMOther25)
p_BM25
ggsave("BM_25.png", height = 7 , width = 7) # Figure 2A
p_BM50 <- BM_plot(BMOther50)
p_BM50
ggsave("BM_50.png", height = 7 , width = 7) # Figure 2A
p_BM75 <- BM_plot(BMOther75)
p_BM75
ggsave("BM_75.png", height = 7 , width = 7) # Figure 2A
axis.ticks.margin = unit(0,"null"),
timeDistOther
colSums(timeDistOther)
# Null model (random shuffling)
no_ev <- colSums(timeDistOther)
no_ev[1,]
no_ev[1]
?sample
matrix(1, 1, 10)
sample(matrix(1, 1, 10),5)
sample([1:10],5)
sample(c(1:10),5)
hi <-matrix(1, 1, 10)
c(1:365) * 0
timeDistOther
hi <- timeDistOther
hi
hi = 0
hi
hi = timeDistOther
hi[,] = 0
hi
no_ev <- colSums(timeDistOther)
null_time <- timeDistOther
null_time[,] <- 0
for (i in 1:74){
idx <- sample(c(1:365), no_ev[i])
null_time[idx,i] <- 1
}
# Null model (random shuffling)
no_ev <- colSums(timeDistOther)
null_time <- timeDistOther
null_time[,] <- 0
for (i in 1:74){
idx <- sample(c(1:365), no_ev[i])
null_time[idx,i] <- 1
}
BMNull <- BM_cal(null_time)
setwd(dir.out)
p_BM_null <- BM_plot(BMNull)
p_BM_null
ggsave("BM_null.png", height = 7 , width = 7) # Supplementary Figure 6
# Calculation of burstiness considering finite event size
setwd(dir.out)
p_AM <- BM_plot(BMOther,finite = TRUE)
p_AM
ggsave("AM_other.png", height = 7 , width = 7)
# Maps of expected coincidence rates and p-values
# Clean data
shp$expected_conf_idp_exp_pois1 <- eca_pois1[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_pois4 <- eca_pois4[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_pois13 <- eca_pois13[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_wtsur1 <- eca_wtsur1[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_wtsur4 <- eca_wtsur4[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_wtsur13 <- eca_wtsur13[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_shuf1 <- eca_shuf1[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_shuf4 <- eca_shuf4[[1]]$`Expected precursor rate`
shp$expected_conf_idp_exp_shuf13 <- eca_shuf13[[1]]$`Expected precursor rate`
shp$expected_rain_idp_exp_pois1 <- eca_pois1[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_pois4 <- eca_pois4[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_pois13 <- eca_pois13[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_wtsur1 <- eca_wtsur1[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_wtsur4 <- eca_wtsur4[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_wtsur13 <- eca_wtsur13[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_shuf1 <- eca_shuf1[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_shuf4 <- eca_shuf4[[2]]$`Expected precursor rate`
shp$expected_rain_idp_exp_shuf13 <- eca_shuf13[[2]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_pois1 <- eca_pois1[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_pois4 <- eca_pois4[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_pois13 <- eca_pois13[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_wtsur1 <- eca_wtsur1[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_wtsur4 <- eca_wtsur4[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_wtsur13 <- eca_wtsur13[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_shuf1 <- eca_shuf1[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_shuf4 <- eca_shuf4[[3]]$`Expected precursor rate`
shp$expected_rain_conf_idp_exp_shuf13 <- eca_shuf13[[3]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_pois1 <- eca_pois1[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_pois4 <- eca_pois4[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_pois13 <- eca_pois13[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_wtsur1 <- eca_wtsur1[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_wtsur4 <- eca_wtsur4[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_wtsur13 <- eca_wtsur13[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_shuf1 <- eca_shuf1[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_shuf4 <- eca_shuf4[[4]]$`Expected precursor rate`
shp$expected_tmax_idp_exp_shuf13 <- eca_shuf13[[4]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_pois1 <- eca_pois1[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_pois4 <- eca_pois4[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_pois13 <- eca_pois13[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_wtsur1 <- eca_wtsur1[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_wtsur4 <- eca_wtsur4[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_wtsur13 <- eca_wtsur13[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_shuf1 <- eca_shuf1[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_shuf4 <- eca_shuf4[[5]]$`Expected precursor rate`
shp$expected_tmax_conf_idp_exp_shuf13 <- eca_shuf13[[5]]$`Expected precursor rate`
# Plot maps
setwd(dir.out)
si_exp_plot(shp,1)
si_exp_plot(shp,4)
si_exp_plot(shp,13)
si_pval_plot(shp,1)
si_pval_plot(shp,4)
si_pval_plot(shp,13)
# lags
setwd(dir.out)
# dt = 1
ggplot() + aes(lag_out1[[1]]$X10)+ geom_histogram(aes(y=..density..),binwidth=1, colour="black", fill="white")+
theme_minimal()+geom_vline(xintercept = mean(lag_out1[[1]]$X10),linetype="dashed",linewidth = 1,colour = "red") +
labs(title="",x="Time lag (week)", y = "Density")+
scale_x_continuous(breaks = seq(0, 8, by = 1)) + ylim(0,1.0)+
theme(axis.text = element_text(size = 15),
axis.title  = element_text(size = 15))
ggsave("conf_mig_lag1.png", height = 7 , width = 7)
### Mobility
timeDistSelf <- ts_crt(outidp_dat,0,"mob")
BMSelf <- BM_cal(timeDistSelf)
setwd(dir.out)
p_BM2 <- BM_plot(BMSelf)
p_BM2
ggsave("BM_self.png", height = 7 , width = 7)
# ECA for mobility
# lag
lag_out_self1 <- lag_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,1)
lag_out_self4 <- lag_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,4)
lag_out_self13 <- lag_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,13)
# Run ECA
eca_self1 <- real_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,1,lag_out_self1,"poisson")
si_pval_plot(shp,1)
si_pval_plot(shp,4)
si_pval_plot(shp,13) # Supplementary Figures 10-13
spplot(shp, "conf_idp_pre_pv_other",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
spplot(shp, "conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
### DATA CLEANING ###
# Load user-defined functions
setwd(dir.udf)
dump("eca_udf", file="eca_udf");source("eca_udf.R")
dump("bursty_GB_udf", file="bursty_GB_udf");source("bursty_GB_udf.R")
dump("bursty_KJ_udf", file="bursty_KJ_udf");source("bursty_KJ_udf.R")
dump("BM_cal_udf", file="BM_cal_udf");source("BM_cal_udf.R")
###
si_pval_plot(shp,1)
plot1 <- spplot(shp, conf_idp_pre_pv_other1,
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
shp$conf_idp_pre_pv_other1
spplot(shp, "conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot1 <- spplot(shp, "conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot2 <-  spplot(shp, "rain_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot3 <-  spplot(shp, "rain_conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot4 <-  spplot(shp, "tmax_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot5 <-  spplot(shp, "tmax_conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
grid.arrange(plot1,plot2,plot3,plot4,plot5,ncol = 5)
png("test.png", width = 3500, height = 800, res = 300)
plot1 <- spplot(shp, "conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot2 <-  spplot(shp, "rain_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot3 <-  spplot(shp, "rain_conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot4 <-  spplot(shp, "tmax_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
plot5 <-  spplot(shp, "tmax_conf_idp_pre_pv_other1",
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
colorkey=FALSE)
grid.arrange(plot1,plot2,plot3,plot4,plot5,ncol = 5)
dev.off()
# Plot maps
# expected coincidence rates of null hypothesis
setwd(dir.out)
si_pval_plot(shp,1)
si_pval_plot(shp,4)
si_pval_plot(shp,13) # Supplementary Figures 10-13
sessionInfo()
# lag
lag_out_self1 <- lag_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,1)
lag_out_self4 <- lag_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,4)
lag_out_self13 <- lag_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,13)
# Run ECA
eca_self1 <- real_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,1,lag_out_self1,"poisson")
eca_self4 <- real_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,4,lag_out_self4,"poisson")
eca_self13 <- real_eca(timeDistSelf,conf_dat,rain_dat,tmax_dat,9,13,lag_out_self13,"poisson")
shp$conf_idp_pre_self1 <- eca_self1[[1]]$`precursor coincidence rate`
shp$conf_idp_pre_self4 <- eca_self4[[1]]$`precursor coincidence rate`
shp$conf_idp_pre_self13 <- eca_self13[[1]]$`precursor coincidence rate`
shp$rain_idp_pre_self1 <- eca_self1[[2]]$`precursor coincidence rate`
shp$rain_idp_pre_self4 <- eca_self4[[2]]$`precursor coincidence rate`
shp$rain_idp_pre_self13 <- eca_self13[[2]]$`precursor coincidence rate`
shp$rain_conf_idp_pre_self1 <- eca_self1[[3]]$`precursor coincidence rate`
shp$rain_conf_idp_pre_self4 <- eca_self4[[3]]$`precursor coincidence rate`
shp$rain_conf_idp_pre_self13 <- eca_self13[[3]]$`precursor coincidence rate`
shp$tmax_idp_pre_self1 <- eca_self1[[4]]$`precursor coincidence rate`
shp$tmax_idp_pre_self4 <- eca_self4[[4]]$`precursor coincidence rate`
shp$tmax_idp_pre_self13 <- eca_self13[[4]]$`precursor coincidence rate`
shp$tmax_conf_idp_pre_self1 <- eca_self1[[5]]$`precursor coincidence rate`
shp$tmax_conf_idp_pre_self4 <- eca_self4[[5]]$`precursor coincidence rate`
shp$tmax_conf_idp_pre_self13 <- eca_self13[[5]]$`precursor coincidence rate`
eca_plot(shp,1,"self")
dt <- 1
type <- "self"
ratefile_rain = paste("coinratemap_rain_",type,dt,".png",sep ="")
occfile_rain = paste("coinnummap_rain_",type,dt,".png",sep ="")
ratefile_tmax = paste("coinratemap_tmax_",type,dt,".png",sep ="")
occfile_tmax = paste("coinnummap_tmax_",type,dt,".png",sep ="")
ratefile_rain
ratename_rain <- c(paste("conf_idp_pre_",type,dt,sep =""),paste("rain_idp_pre_",type,dt,sep =""),
paste("rain_conf_idp_pre_",type,dt,sep =""))
occname_rain <- c(paste("conf_idp_pre_n_",type,dt,sep =""),paste("rain_idp_pre_n_",type,dt,sep =""),
paste("rain_conf_idp_pre_n_",type,dt,sep =""))
ratename_tmax <- c(paste("conf_idp_pre_",type,dt,sep =""),paste("tmax_idp_pre_",type,dt,sep =""),
paste("tmax_conf_idp_pre_",type,dt,sep =""))
occname_tmax <- c(paste("conf_idp_pre_n_",type,dt,sep =""),paste("tmax_idp_pre_n_",type,dt,sep =""),
paste("tmax_conf_idp_pre_n_",type,dt,sep =""))
ratename_rain
shp$conf_idp_pre_self1
plot1 <- spplot(shp, ratename_rain[1],
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
#main=list(label="Conflict &",cex=1),
sp.layout = list(
list("sp.polygons",shp, first = TRUE, fill = "gray")
))
plot2 <-  spplot(shp, ratename_rain[2],
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
#main=list(label="Conflict &",cex=1),
sp.layout = list(
list("sp.polygons",shp, first = TRUE, fill = "gray")
))
plot3 <-  spplot(shp, ratename_rain[3],
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
#main=list(label="Conflict &",cex=1),
sp.layout = list(
list("sp.polygons",shp, first = TRUE, fill = "gray")
))
grid.arrange(plot1,plot2,plot3,ncol = 3)
grid.arrange(plot1,plot2,plot3,ncol = 3)
plot1 <- spplot(shp, ratename_tmax[1],
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
#main=list(label="Conflict &",cex=1),
sp.layout = list(
list("sp.polygons",shp, first = TRUE, fill = "gray")
))
plot2 <-  spplot(shp, ratename_tmax[2],
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
#main=list(label="Conflict &",cex=1),
sp.layout = list(
list("sp.polygons",shp, first = TRUE, fill = "gray")
))
plot3 <-  spplot(shp, ratename_tmax[3],
col.regions = rev(heat.colors(101)),
at = seq(-0.001,1.001,length=100),
lwd = 1,
#main=list(label="Conflict &",cex=1),
sp.layout = list(
list("sp.polygons",shp, first = TRUE, fill = "gray")
))
grid.arrange(plot1,plot2,plot3,ncol = 3)
setwd(dir.udf)
dump("eca_udf", file="eca_udf");source("eca_udf.R")
dump("bursty_GB_udf", file="bursty_GB_udf");source("bursty_GB_udf.R")
dump("bursty_KJ_udf", file="bursty_KJ_udf");source("bursty_KJ_udf.R")
dump("BM_cal_udf", file="BM_cal_udf");source("BM_cal_udf.R")
###
setwd(dir.out)
eca_plot(shp,1,"self", occ = FALSE)
setwd(dir.udf)
dump("eca_udf", file="eca_udf");source("eca_udf.R")
dump("bursty_GB_udf", file="bursty_GB_udf");source("bursty_GB_udf.R")
dump("bursty_KJ_udf", file="bursty_KJ_udf");source("bursty_KJ_udf.R")
dump("BM_cal_udf", file="BM_cal_udf");source("BM_cal_udf.R")
###
setwd(dir.out)
eca_plot(shp,1,"self", occ = FALSE)
eca_plot(shp,4,"self", occ = FALSE)
eca_plot(shp,13,"self", occ = FALSE) # Supplementary Figure 17
corr_plot(BMSelf,eca_self1,1,0.05,nan_ctr = FALSE,"self")
corr_plot(BMSelf,eca_self4,4,0.05,nan_ctr = FALSE,"self")
corr_plot(BMSelf,eca_self13,13,0.05,nan_ctr = FALSE,"self") # Supplementary Figure 18
View(hi)
rm(hi)
rm(dt)
rm(i)
rm(idx)
rm(int)
